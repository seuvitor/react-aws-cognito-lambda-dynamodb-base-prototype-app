{"version":3,"file":"index.js","sources":["../src/AppConfigContext.tsx","../src/core/authentication.ts","../src/UserContext.tsx","../src/DDBContext.tsx","../src/LambdaContext.tsx","../src/MessageContext.tsx","../src/SpinnerContext.tsx","../src/InfrastructureProvider.tsx","../src/core/authRedirect.ts","../src/useAuthRedirect.ts","../src/BaseAppScope.tsx","../src/core/makeAppConfig.ts","../src/useAppBarState.ts","../src/useAppDrawerState.ts"],"sourcesContent":["import type { PropsWithChildren } from \"react\";\nimport { createContext, useContext } from \"react\";\nimport type { AppConfig } from \"./core/makeAppConfig\";\n\ntype AppConfigContextValue =\n\t| {\n\t\t\tappConfig: AppConfig;\n\t  }\n\t| undefined;\n\nconst AppConfigContext = createContext<AppConfigContextValue>(undefined);\n\ntype AppConfigProviderProps = PropsWithChildren<{\n\tappConfig: AppConfig;\n}>;\n\nconst AppConfigProvider = ({ appConfig, children }: AppConfigProviderProps) => (\n\t<AppConfigContext.Provider value={{ appConfig }}>\n\t\t{children}\n\t</AppConfigContext.Provider>\n);\n\nconst useAppConfig = () => {\n\tconst ctx = useContext(AppConfigContext);\n\n\tif (ctx === undefined) {\n\t\tthrow new Error(\n\t\t\t\"useAppConfig can only be used in the scope of a AppConfigProvider\",\n\t\t);\n\t}\n\n\tconst { appConfig } = ctx;\n\treturn { appConfig };\n};\n\nexport default useAppConfig;\nexport { AppConfigProvider };\n","import { CognitoIdentityClient } from \"@aws-sdk/client-cognito-identity\";\nimport {\n\ttype CognitoIdentityCredentialProvider,\n\tfromCognitoIdentityPool,\n} from \"@aws-sdk/credential-provider-cognito-identity\";\nimport type { AppConfig, AppMessages } from \"./makeAppConfig\";\n\nconst initialUserState = {\n\tappConfig: undefined,\n\tuser: {\n\t\tidentityId: undefined,\n\t\tid: undefined,\n\t\tname: undefined,\n\t\temail: undefined,\n\t\tgroups: undefined,\n\t\tidToken: undefined,\n\t\taccessToken: undefined,\n\t},\n\trefreshToken: undefined,\n\tawsConfig: undefined,\n\tawsCredentials: undefined,\n};\n\nconst getRefreshTokenFromSessionStorage = (appRefreshTokenStorageKey: string) =>\n\tsessionStorage.getItem(appRefreshTokenStorageKey);\n\nconst updateRefreshTokenInSessionStorage = (\n\trefreshToken: string | undefined,\n\tappRefreshTokenStorageKey: string,\n) => {\n\tif (refreshToken) {\n\t\tsessionStorage.setItem(appRefreshTokenStorageKey, refreshToken);\n\t} else {\n\t\tsessionStorage.removeItem(appRefreshTokenStorageKey);\n\t}\n};\n\ntype AwsCredentialsState = {\n\tawsCredentials: undefined | CognitoIdentityCredentialProvider;\n\tuser: {\n\t\tidentityId: undefined | string;\n\t\tid: undefined | string;\n\t\tname: undefined | string;\n\t\temail: undefined | string;\n\t\tgroups: undefined | string[];\n\t\tidToken: undefined | string;\n\t\taccessToken: undefined | string;\n\t};\n\tawsConfig:\n\t\t| undefined\n\t\t| {\n\t\t\t\tregion: undefined | string;\n\t\t\t\tcredentials: undefined | CognitoIdentityCredentialProvider;\n\t\t  };\n};\n\nexport type LoginState = AwsCredentialsState & {\n\trefreshToken: undefined | string;\n};\n\nconst stateUpdateFromClearAwsCredentials: AwsCredentialsState = {\n\tawsCredentials: undefined,\n\tuser: {\n\t\tidentityId: undefined,\n\t\tid: undefined,\n\t\tname: undefined,\n\t\temail: undefined,\n\t\tgroups: undefined,\n\t\tidToken: undefined,\n\t\taccessToken: undefined,\n\t},\n\tawsConfig: undefined,\n};\n\nconst stateUpdateFromFailedLogin: LoginState = {\n\t...stateUpdateFromClearAwsCredentials,\n\trefreshToken: undefined,\n};\n\nconst stateUpdateFromNewAwsCredentials = (\n\tawsCredentials: CognitoIdentityCredentialProvider,\n\tidentityId: string,\n\tidToken: string | undefined,\n\taccessToken: string | undefined,\n\tappMessages: AppMessages,\n\tappRegion: string,\n): AwsCredentialsState => {\n\tconst idTokenPayload = idToken && JSON.parse(atob(idToken.split(\".\")[1]));\n\tconst user = {\n\t\tidentityId,\n\t\tid: idTokenPayload?.sub,\n\t\tname: idTokenPayload ? idTokenPayload.name : appMessages.LOGGED_OUT_USER,\n\t\temail: idTokenPayload?.email,\n\t\tgroups: idTokenPayload?.[\"cognito:groups\"],\n\t\tidToken,\n\t\taccessToken,\n\t};\n\tconst awsConfig = awsCredentials\n\t\t? { region: appRegion, credentials: awsCredentials }\n\t\t: undefined;\n\n\treturn {\n\t\tawsCredentials,\n\t\tuser,\n\t\tawsConfig,\n\t};\n};\n\nconst loginWithAwsCognitoIdentityPoolSemDispatch = (\n\tappConfig: AppConfig,\n\tidToken?: string,\n\taccessToken?: string,\n): Promise<AwsCredentialsState> => {\n\tconst { appIdentityPoolId, appRegion, appUserPoolId, appMessages } =\n\t\tappConfig;\n\n\tconst newCredentials = fromCognitoIdentityPool({\n\t\tclient: new CognitoIdentityClient({\n\t\t\tregion: appRegion,\n\t\t}),\n\t\tidentityPoolId: appIdentityPoolId,\n\t\t...(idToken && { logins: { [appUserPoolId]: idToken } }),\n\t});\n\n\treturn new Promise((resolve, reject) => {\n\t\tnewCredentials()\n\t\t\t.then((creds) => {\n\t\t\t\tresolve(\n\t\t\t\t\tstateUpdateFromNewAwsCredentials(\n\t\t\t\t\t\tnewCredentials,\n\t\t\t\t\t\tcreds.identityId,\n\t\t\t\t\t\tidToken,\n\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\tappMessages,\n\t\t\t\t\t\tappRegion,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\treject(err);\n\t\t\t});\n\t});\n};\n\nconst refreshIdAndAccessTokensSemDispatch = (\n\tappConfig: AppConfig,\n\trefreshToken?: string,\n): Promise<AwsCredentialsState> => {\n\tconst { appAuthUrl, appClientId, appMessages } = appConfig;\n\treturn new Promise((resolve, reject) => {\n\t\tif (refreshToken) {\n\t\t\tfetch(appAuthUrl, {\n\t\t\t\tmethod: \"POST\",\n\t\t\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\t\t\tbody: `grant_type=refresh_token&client_id=${appClientId}&refresh_token=${refreshToken}`,\n\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tresponse\n\t\t\t\t\t\t.json()\n\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\tloginWithAwsCognitoIdentityPoolSemDispatch(\n\t\t\t\t\t\t\t\tappConfig,\n\t\t\t\t\t\t\t\tres.id_token,\n\t\t\t\t\t\t\t\tres.access_token,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.then((stateUpdate) => {\n\t\t\t\t\t\t\t\t\tresolve(stateUpdate);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t\tappMessages.LOG_COULD_NOT_LOGIN_WITH_REFRESHED_TOKENS,\n\t\t\t\t\t\t\t\t\t\terr,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\tappMessages.LOG_COULD_NOT_DECODE_AUTHENTICATION_RESPONSE,\n\t\t\t\t\t\t\t\terr,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error(appMessages.LOG_COULD_NOT_GET_REFRESHED_TOKENS, err);\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t} else {\n\t\t\tconsole.warn(appMessages.LOG_NO_REFRESH_TOKEN_AVAILABLE);\n\t\t\treject(Error(appMessages.LOG_NO_REFRESH_TOKEN_AVAILABLE));\n\t\t}\n\t});\n};\n\nconst loginWithAuthorizationCodeSemDispatch = (\n\tappConfig: AppConfig,\n\tauthorizationCode: string,\n): Promise<LoginState> => {\n\tconst { appAuthUrl, appClientId, appAuthRedirect, appMessages } = appConfig;\n\treturn new Promise((resolve, reject) => {\n\t\tfetch(appAuthUrl, {\n\t\t\tmethod: \"POST\",\n\t\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\t\tbody: `grant_type=authorization_code&client_id=${appClientId}&code=${authorizationCode}&redirect_uri=${appAuthRedirect}`,\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tresponse\n\t\t\t\t\t.json()\n\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\trefreshIdAndAccessTokensSemDispatch(appConfig, res.refresh_token)\n\t\t\t\t\t\t\t.then((stateUpdate) => {\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\t...stateUpdate,\n\t\t\t\t\t\t\t\t\trefreshToken: res.refresh_token,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\tappMessages.LOG_COULD_NOT_LOGIN_WITH_REFRESHED_TOKENS,\n\t\t\t\t\t\t\t\t\terr,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\tappMessages.LOG_COULD_NOT_DECODE_AUTHENTICATION_RESPONSE,\n\t\t\t\t\t\t\terr,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.error(appMessages.LOG_COULD_NOT_GET_IDENTIFICATION_TOKENS, err);\n\t\t\t\treject(err);\n\t\t\t});\n\t});\n};\n\nconst logoff = (\n\tsetUserState: (action: (prevState: LoginState) => LoginState) => void,\n\tappConfig: AppConfig,\n): Promise<void> =>\n\tnew Promise((resolve, _reject) => {\n\t\tupdateRefreshTokenInSessionStorage(\n\t\t\tundefined,\n\t\t\tappConfig.appRefreshTokenStorageKey,\n\t\t);\n\t\tsetUserState((_prevState) => stateUpdateFromFailedLogin);\n\t\tresolve();\n\t});\n\nconst setAppConfig = (\n\tsetUserState: (action: (prevState: LoginState) => LoginState) => void,\n\tappConfig: AppConfig,\n) => {\n\tconst refreshToken = getRefreshTokenFromSessionStorage(\n\t\tappConfig.appRefreshTokenStorageKey,\n\t);\n\tif (refreshToken) {\n\t\trefreshIdAndAccessTokens(setUserState, appConfig, refreshToken);\n\t}\n};\n\nconst loginWithAwsCognitoIdentityPool = (\n\tsetUserState: (action: (prevState: LoginState) => LoginState) => void,\n\tappConfig: AppConfig,\n\tidToken?: string,\n\taccessToken?: string,\n): void => {\n\tloginWithAwsCognitoIdentityPoolSemDispatch(appConfig, idToken, accessToken)\n\t\t.then((stateUpdate) => {\n\t\t\tsetUserState((oldState: LoginState) => ({ ...oldState, stateUpdate }));\n\t\t})\n\t\t.catch(() => {\n\t\t\tsetUserState((_prevState) => stateUpdateFromFailedLogin);\n\t\t});\n};\n\nconst refreshIdAndAccessTokens = (\n\tsetUserState: (action: (prevState: LoginState) => LoginState) => void,\n\tappConfig: AppConfig,\n\trefreshToken?: string,\n): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\trefreshIdAndAccessTokensSemDispatch(appConfig, refreshToken)\n\t\t\t.then((stateUpdate) => {\n\t\t\t\tsetUserState((prevState) => ({ ...prevState, ...stateUpdate }));\n\t\t\t\tresolve();\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tsetUserState((_prevState) => stateUpdateFromFailedLogin);\n\t\t\t\treject(err);\n\t\t\t});\n\t});\n\nconst loginWithAuthorizationCode = (\n\tsetUserState: (action: (prevState: LoginState) => LoginState) => void,\n\tappConfig: AppConfig,\n\tauthorizationCode: string,\n): Promise<void> =>\n\tnew Promise((resolve, reject) => {\n\t\tloginWithAuthorizationCodeSemDispatch(appConfig, authorizationCode)\n\t\t\t.then((stateUpdate) => {\n\t\t\t\tconst { refreshToken } = stateUpdate;\n\t\t\t\tupdateRefreshTokenInSessionStorage(\n\t\t\t\t\trefreshToken,\n\t\t\t\t\tappConfig.appRefreshTokenStorageKey,\n\t\t\t\t);\n\t\t\t\tsetUserState((_prevState) => stateUpdate);\n\t\t\t\tresolve();\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconst refreshToken = undefined;\n\t\t\t\tupdateRefreshTokenInSessionStorage(\n\t\t\t\t\trefreshToken,\n\t\t\t\t\tappConfig.appRefreshTokenStorageKey,\n\t\t\t\t);\n\t\t\t\tsetUserState((_prevState) => stateUpdateFromFailedLogin);\n\t\t\t\treject(err);\n\t\t\t});\n\t});\n\nexport {\n\tlogoff,\n\tsetAppConfig,\n\tloginWithAwsCognitoIdentityPool,\n\trefreshIdAndAccessTokens,\n\tloginWithAuthorizationCode,\n\tinitialUserState,\n};\n","import type { CognitoIdentityCredentialProvider } from \"@aws-sdk/credential-provider-cognito-identity\";\nimport type { PropsWithChildren } from \"react\";\nimport {\n\tcreateContext,\n\tuseCallback,\n\tuseContext,\n\tuseEffect,\n\tuseState,\n} from \"react\";\nimport useAppConfig from \"./AppConfigContext\";\nimport type { LoginState } from \"./core/authentication\";\nimport {\n\tloginWithAuthorizationCode as _loginWithAuthorizationCode,\n\tloginWithAwsCognitoIdentityPool as _loginWithAwsCognitoIdentityPool,\n\tlogoff as _logoff,\n\trefreshIdAndAccessTokens as _refreshIdAndAccessTokens,\n\tsetAppConfig as _setAppConfig,\n\tinitialUserState,\n} from \"./core/authentication\";\n\ntype UserContextValue = {\n\tawsCredentials: undefined | CognitoIdentityCredentialProvider;\n\tuser: {\n\t\tidentityId: undefined | string;\n\t\tid: undefined | string;\n\t\tname: undefined | string;\n\t\temail: undefined | string;\n\t\tgroups: undefined | string[];\n\t\tidToken: undefined | string;\n\t\taccessToken: undefined | string;\n\t};\n\tawsConfig:\n\t\t| undefined\n\t\t| {\n\t\t\t\tregion: undefined | string;\n\t\t\t\tcredentials: undefined | CognitoIdentityCredentialProvider;\n\t\t  };\n\n\tloginAnonymously: () => void;\n\tloginWithAuthorizationCode: (authorizationCode: string) => Promise<void>;\n\tlogoff: () => Promise<void>;\n};\n\nconst initialUserContextValue = {\n\tuser: initialUserState.user,\n\tawsConfig: initialUserState.awsConfig,\n\tawsCredentials: initialUserState.awsCredentials,\n\tloginAnonymously: () => {},\n\tloginWithAuthorizationCode: () => Promise.reject(),\n\tlogoff: () => Promise.reject(),\n};\n\nconst UserContext = createContext<UserContextValue>(initialUserContextValue);\n\nconst useSetInterval = (callback: () => void, seconds: number) => {\n\tuseEffect(() => {\n\t\tconst intervalHandle = setInterval(callback, seconds);\n\t\treturn () => clearInterval(intervalHandle);\n\t}, [callback, seconds]);\n};\n\nconst REFRESH_TOKEN_INTERVAL = 25 * 60000;\n\nconst UserProvider = ({ children }: PropsWithChildren) => {\n\tconst { appConfig } = useAppConfig();\n\tconst { appMessages } = appConfig;\n\n\tconst [userState, setUserState] = useState<LoginState>(initialUserState);\n\n\tuseEffect(() => {\n\t\t_setAppConfig(setUserState, appConfig);\n\t}, [appConfig]);\n\n\tconst logoff = useCallback(\n\t\t() => _logoff(setUserState, appConfig),\n\t\t[appConfig],\n\t);\n\n\tconst loginWithAwsCognitoIdentityPool = useCallback(\n\t\t(idToken: string | undefined, accessToken: string | undefined) =>\n\t\t\t_loginWithAwsCognitoIdentityPool(\n\t\t\t\tsetUserState,\n\t\t\t\tappConfig,\n\t\t\t\tidToken,\n\t\t\t\taccessToken,\n\t\t\t),\n\t\t[appConfig],\n\t);\n\n\tconst refreshIdAndAccessTokens = useCallback(\n\t\t() =>\n\t\t\t_refreshIdAndAccessTokens(\n\t\t\t\tsetUserState,\n\t\t\t\tappConfig,\n\t\t\t\tuserState.refreshToken,\n\t\t\t),\n\t\t[appConfig, userState.refreshToken],\n\t);\n\n\tconst scheduledRefreshIdAndAccessTokens = useCallback(() => {\n\t\trefreshIdAndAccessTokens().catch(() => {\n\t\t\tconsole.warn(appMessages.LOG_COULD_NOT_REFRESH_TOKENS);\n\t\t});\n\t}, [refreshIdAndAccessTokens, appMessages]);\n\n\tuseSetInterval(scheduledRefreshIdAndAccessTokens, REFRESH_TOKEN_INTERVAL);\n\n\tconst loginAnonymously = useCallback(\n\t\t() => loginWithAwsCognitoIdentityPool(undefined, undefined),\n\t\t[loginWithAwsCognitoIdentityPool],\n\t);\n\n\tconst loginWithAuthorizationCode = useCallback(\n\t\t(authorizationCode: string) =>\n\t\t\t_loginWithAuthorizationCode(setUserState, appConfig, authorizationCode),\n\t\t[appConfig],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!userState.awsCredentials) {\n\t\t\trefreshIdAndAccessTokens().catch(() => {\n\t\t\t\tconsole.warn(appMessages.LOG_COULD_NOT_REFRESH_TOKENS);\n\t\t\t});\n\t\t}\n\t}, [userState.awsCredentials, refreshIdAndAccessTokens, appMessages]);\n\n\treturn (\n\t\t<UserContext.Provider\n\t\t\tvalue={{\n\t\t\t\tuser: userState.user,\n\t\t\t\tawsConfig: userState.awsConfig,\n\t\t\t\tawsCredentials: userState.awsCredentials,\n\t\t\t\tloginAnonymously,\n\t\t\t\tloginWithAuthorizationCode,\n\t\t\t\tlogoff,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</UserContext.Provider>\n\t);\n};\n\nconst useUser = () => {\n\tconst {\n\t\tuser,\n\t\tawsConfig,\n\t\tawsCredentials,\n\t\tloginAnonymously,\n\t\tloginWithAuthorizationCode,\n\t\tlogoff,\n\t} = useContext(UserContext);\n\n\treturn {\n\t\tuser,\n\t\tawsConfig,\n\t\tawsCredentials,\n\t\tloginAnonymously,\n\t\tloginWithAuthorizationCode,\n\t\tlogoff,\n\t};\n};\n\nexport default useUser;\nexport { UserProvider };\n","import { DynamoDBClient } from \"@aws-sdk/client-dynamodb\";\nimport type {\n\tGetCommandInput,\n\tGetCommandOutput,\n\tPutCommandInput,\n\tPutCommandOutput,\n\tUpdateCommandInput,\n\tUpdateCommandOutput,\n} from \"@aws-sdk/lib-dynamodb\";\nimport {\n\tDynamoDBDocumentClient,\n\tGetCommand,\n\tPutCommand,\n\tUpdateCommand,\n} from \"@aws-sdk/lib-dynamodb\";\nimport type { PropsWithChildren } from \"react\";\nimport {\n\tcreateContext,\n\tuseCallback,\n\tuseContext,\n\tuseEffect,\n\tuseState,\n} from \"react\";\nimport useUser from \"./UserContext\";\n\ntype DDBContextValue = {\n\tdocumentDB?: DynamoDBDocumentClient;\n};\n\nconst DDBContext = createContext<DDBContextValue>({\n\tdocumentDB: undefined,\n});\n\nconst DDBProvider = ({ children }: PropsWithChildren) => {\n\tconst { awsConfig, awsCredentials } = useUser();\n\tconst [documentDB, setDocumentDB] = useState<DynamoDBDocumentClient>();\n\n\tuseEffect(() => {\n\t\tif (awsConfig) {\n\t\t\tconst ddbClient = new DynamoDBClient(awsConfig);\n\t\t\tsetDocumentDB(DynamoDBDocumentClient.from(ddbClient));\n\t\t} else {\n\t\t\tsetDocumentDB(undefined);\n\t\t}\n\t}, [awsConfig]);\n\n\tuseEffect(() => {\n\t\tif (awsCredentials) {\n\t\t\tsetDocumentDB((oldDocumentDB) => {\n\t\t\t\tif (oldDocumentDB) {\n\t\t\t\t\toldDocumentDB.config.credentials = awsCredentials;\n\t\t\t\t}\n\t\t\t\treturn oldDocumentDB;\n\t\t\t});\n\t\t}\n\t}, [awsCredentials]);\n\n\treturn (\n\t\t<DDBContext.Provider value={{ documentDB }}>{children}</DDBContext.Provider>\n\t);\n};\n\ntype DDBGetCommandOutput<T> = Omit<GetCommandOutput, \"Item\"> & {\n\tItem?: T;\n};\n\ntype UseDDBReturnType<T> = {\n\tdocumentDB: DynamoDBDocumentClient | undefined;\n\tddbGet?: (params: GetCommandInput) => Promise<DDBGetCommandOutput<T>>;\n\tddbPut?: (params: PutCommandInput) => Promise<PutCommandOutput>;\n\tddbUpdate?: (params: UpdateCommandInput) => Promise<UpdateCommandOutput>;\n};\n\nconst useDDB = <T,>(): UseDDBReturnType<T> => {\n\tconst { documentDB } = useContext(DDBContext);\n\n\tconst ddbGet = useCallback(\n\t\t(params: GetCommandInput) =>\n\t\t\tdocumentDB\n\t\t\t\t? documentDB\n\t\t\t\t\t\t.send(new GetCommand(params))\n\t\t\t\t\t\t.then((output) => output as DDBGetCommandOutput<T>)\n\t\t\t\t: Promise.reject<DDBGetCommandOutput<T>>(),\n\t\t[documentDB],\n\t);\n\n\tconst ddbPut = useCallback(\n\t\t(params: PutCommandInput) =>\n\t\t\tdocumentDB\n\t\t\t\t? documentDB.send(new PutCommand(params))\n\t\t\t\t: Promise.reject<PutCommandOutput>(),\n\t\t[documentDB],\n\t);\n\n\tconst ddbUpdate = useCallback(\n\t\t(params: UpdateCommandInput) =>\n\t\t\tdocumentDB\n\t\t\t\t? documentDB.send(new UpdateCommand(params))\n\t\t\t\t: Promise.reject<UpdateCommandOutput>(),\n\t\t[documentDB],\n\t);\n\n\tif (!documentDB) {\n\t\treturn {\n\t\t\tdocumentDB: undefined,\n\t\t\tddbGet: undefined,\n\t\t\tddbPut: undefined,\n\t\t\tddbUpdate: undefined,\n\t\t};\n\t}\n\n\treturn {\n\t\tdocumentDB,\n\t\tddbGet,\n\t\tddbPut,\n\t\tddbUpdate,\n\t};\n};\n\nexport default useDDB;\nexport { DDBProvider };\n","import type { InvokeCommandInput } from \"@aws-sdk/client-lambda\";\nimport { InvokeCommand, LambdaClient } from \"@aws-sdk/client-lambda\";\nimport type { PropsWithChildren } from \"react\";\nimport {\n\tcreateContext,\n\tuseCallback,\n\tuseContext,\n\tuseEffect,\n\tuseState,\n} from \"react\";\nimport useUser from \"./UserContext\";\n\ntype LambdaContextValue = {\n\tinvokeLambda?: (functionName: string, payload: object) => Promise<object>;\n};\n\nconst LambdaContext = createContext<LambdaContextValue>({\n\tinvokeLambda: undefined,\n});\n\nconst LambdaProvider = ({ children }: PropsWithChildren) => {\n\tconst {\n\t\tuser: { accessToken },\n\t\tawsConfig,\n\t\tawsCredentials,\n\t} = useUser();\n\tconst [lambda, setLambda] = useState<LambdaClient>();\n\n\tuseEffect(() => {\n\t\tif (awsConfig) {\n\t\t\tsetLambda(new LambdaClient(awsConfig));\n\t\t} else {\n\t\t\tsetLambda(undefined);\n\t\t}\n\t}, [awsConfig]);\n\n\tuseEffect(() => {\n\t\tif (awsCredentials) {\n\t\t\tsetLambda((oldLambda) => {\n\t\t\t\tif (oldLambda) {\n\t\t\t\t\toldLambda.config.credentials = awsCredentials;\n\t\t\t\t}\n\t\t\t\treturn oldLambda;\n\t\t\t});\n\t\t}\n\t}, [awsCredentials]);\n\n\tconst invokeLambda = useCallback(\n\t\t(functionName: string, payload: object) => {\n\t\t\tif (lambda) {\n\t\t\t\tconst encoder = new TextEncoder();\n\t\t\t\tconst decoder = new TextDecoder();\n\t\t\t\tconst params: InvokeCommandInput = {\n\t\t\t\t\tFunctionName: functionName,\n\t\t\t\t\tClientContext: btoa(JSON.stringify({ custom: { accessToken } })),\n\t\t\t\t\tPayload: payload\n\t\t\t\t\t\t? encoder.encode(JSON.stringify(payload))\n\t\t\t\t\t\t: undefined,\n\t\t\t\t};\n\t\t\t\tconst command = new InvokeCommand(params);\n\t\t\t\treturn new Promise<object>((resolve, reject) => {\n\t\t\t\t\tlambda\n\t\t\t\t\t\t.send(command)\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!data.StatusCode ||\n\t\t\t\t\t\t\t\tdata.StatusCode !== 200 ||\n\t\t\t\t\t\t\t\t!data.Payload\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\treject(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst responsePayload = JSON.parse(decoder.decode(data.Payload));\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!responsePayload ||\n\t\t\t\t\t\t\t\t!responsePayload.statusCode ||\n\t\t\t\t\t\t\t\tresponsePayload.statusCode !== 200\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\treject(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresolve(responsePayload.body);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Promise.reject(\"Lambda client is undefined\");\n\t\t},\n\t\t[lambda, accessToken],\n\t);\n\n\treturn (\n\t\t<LambdaContext.Provider\n\t\t\tvalue={{ invokeLambda: lambda ? invokeLambda : undefined }}\n\t\t>\n\t\t\t{children}\n\t\t</LambdaContext.Provider>\n\t);\n};\n\nconst useLambda = () => {\n\tconst { invokeLambda } = useContext(LambdaContext);\n\n\treturn { invokeLambda };\n};\n\nexport default useLambda;\nexport { LambdaProvider };\n","import type { PropsWithChildren } from \"react\";\nimport {\n\tcreateContext,\n\tuseCallback,\n\tuseContext,\n\tuseEffect,\n\tuseState,\n} from \"react\";\n\ntype MessageContextValue = {\n\tmessage: string | undefined;\n\tshowMessage: (message: string) => void;\n\tdismissMessage: () => void;\n};\n\nconst MessageContext = createContext<MessageContextValue>({\n\tmessage: \"\",\n\tshowMessage: (_message: string) => {},\n\tdismissMessage: () => {},\n});\n\nconst MessageProvider = ({ children }: PropsWithChildren) => {\n\tconst [snackPack, setSnackPack] = useState<string[]>([]);\n\tconst [message, setMessage] = useState<string>();\n\n\tuseEffect(() => {\n\t\tif (snackPack.length && !message) {\n\t\t\tsetMessage(snackPack[0]);\n\t\t\tsetSnackPack((prev) => prev.slice(1));\n\t\t}\n\t}, [snackPack, message]);\n\n\tconst showMessage = useCallback((newMessage: string) => {\n\t\tsetSnackPack((prev) => [...prev, newMessage]);\n\t}, []);\n\n\tconst dismissMessage = useCallback(() => {\n\t\tsetMessage(undefined);\n\t}, []);\n\n\treturn (\n\t\t<MessageContext.Provider value={{ message, showMessage, dismissMessage }}>\n\t\t\t{children}\n\t\t</MessageContext.Provider>\n\t);\n};\n\nconst useMessage = () => {\n\tconst { showMessage } = useContext(MessageContext);\n\n\treturn { showMessage };\n};\n\nconst useMessageAreaState = () => {\n\tconst { message, dismissMessage } = useContext(MessageContext);\n\n\treturn { message, dismissMessage };\n};\n\nexport default useMessage;\nexport { MessageProvider, useMessageAreaState };\n","import type { PropsWithChildren } from \"react\";\nimport { createContext, useCallback, useContext, useState } from \"react\";\n\ntype SpinnerContextValue = {\n\tshowSpinner: () => void;\n\tdismissSpinner: () => void;\n\tshowing: boolean;\n};\n\nconst SpinnerContext = createContext<SpinnerContextValue>({\n\tshowSpinner: () => {},\n\tdismissSpinner: () => {},\n\tshowing: false,\n});\n\nconst SpinnerProvider = ({ children }: PropsWithChildren) => {\n\tconst [spinnerCount, setSpinnerCount] = useState(0);\n\n\tconst showSpinner = useCallback(() => {\n\t\tsetSpinnerCount((prev) => prev + 1);\n\t}, []);\n\n\tconst dismissSpinner = useCallback(() => {\n\t\tsetSpinnerCount((prev) => prev - 1);\n\t}, []);\n\n\tconst showing = spinnerCount > 0;\n\n\treturn (\n\t\t<SpinnerContext.Provider value={{ showSpinner, dismissSpinner, showing }}>\n\t\t\t{children}\n\t\t</SpinnerContext.Provider>\n\t);\n};\n\nconst useSpinner = () => {\n\tconst { showSpinner, dismissSpinner } = useContext(SpinnerContext);\n\n\treturn { showSpinner, dismissSpinner };\n};\n\nconst useSpinnerAreaState = () => {\n\tconst { showing } = useContext(SpinnerContext);\n\n\treturn { showing };\n};\n\nexport default useSpinner;\nexport { SpinnerProvider, useSpinnerAreaState };\n","import type { PropsWithChildren } from \"react\";\nimport { AppConfigProvider } from \"./AppConfigContext\";\nimport type { AppConfig } from \"./core/makeAppConfig\";\nimport { DDBProvider } from \"./DDBContext\";\nimport { LambdaProvider } from \"./LambdaContext\";\nimport { MessageProvider } from \"./MessageContext\";\nimport { SpinnerProvider } from \"./SpinnerContext\";\nimport { UserProvider } from \"./UserContext\";\n\ntype InfrastructureProviderProps = PropsWithChildren<{\n\tappConfig: AppConfig;\n}>;\n\nconst InfrastructureProvider = ({\n\tappConfig,\n\tchildren,\n}: InfrastructureProviderProps) => (\n\t<MessageProvider>\n\t\t<SpinnerProvider>\n\t\t\t<AppConfigProvider appConfig={appConfig}>\n\t\t\t\t<UserProvider>\n\t\t\t\t\t<DDBProvider>\n\t\t\t\t\t\t<LambdaProvider>{children}</LambdaProvider>\n\t\t\t\t\t</DDBProvider>\n\t\t\t\t</UserProvider>\n\t\t\t</AppConfigProvider>\n\t\t</SpinnerProvider>\n\t</MessageProvider>\n);\n\nexport default InfrastructureProvider;\n","import type { AppMessages } from \"./makeAppConfig\";\n\nconst authRedirect = (\n\tappBasePath: string | undefined,\n\tshowSpinner: () => void,\n\tdismissSpinner: () => void,\n\tloginWithAuthorizationCode: (authorizationCode: string) => Promise<void>,\n\tshowMessage: (message: string) => void,\n\tappMessages: AppMessages | undefined,\n) => {\n\tif (window.location.pathname === appBasePath) {\n\t\tconst search = new URLSearchParams(window.location.search);\n\t\tif (search.get(\"auth-redirect\") !== null && search.get(\"code\") !== null) {\n\t\t\twindow.history.replaceState({}, \"\", window.location.pathname);\n\t\t\tconst authorizationCode = search.get(\"code\");\n\n\t\t\tif (authorizationCode) {\n\t\t\t\tshowSpinner();\n\t\t\t\tloginWithAuthorizationCode(authorizationCode)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tif (appMessages) {\n\t\t\t\t\t\t\tshowMessage(appMessages.LOGIN_SUCCESSFUL);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tif (appMessages) {\n\t\t\t\t\t\t\tshowMessage(appMessages.LOGIN_FAILED);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tdismissSpinner();\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport default authRedirect;\n","import { useEffect } from \"react\";\nimport useAppConfig from \"./AppConfigContext\";\nimport authRedirect from \"./core/authRedirect\";\nimport useMessage from \"./MessageContext\";\nimport useSpinner from \"./SpinnerContext\";\nimport useUser from \"./UserContext\";\n\nconst useAuthRedirect = () => {\n\tconst {\n\t\tappConfig: { appBasePath, appMessages },\n\t} = useAppConfig();\n\n\tconst { showMessage } = useMessage();\n\tconst { showSpinner, dismissSpinner } = useSpinner();\n\tconst { loginWithAuthorizationCode } = useUser();\n\n\tuseEffect(() => {\n\t\tauthRedirect(\n\t\t\tappBasePath,\n\t\t\tshowSpinner,\n\t\t\tdismissSpinner,\n\t\t\tloginWithAuthorizationCode,\n\t\t\tshowMessage,\n\t\t\tappMessages,\n\t\t);\n\t}, [\n\t\tappBasePath,\n\t\tshowSpinner,\n\t\tdismissSpinner,\n\t\tloginWithAuthorizationCode,\n\t\tshowMessage,\n\t\tappMessages,\n\t]);\n};\n\nexport default useAuthRedirect;\n","import type { PropsWithChildren, ReactNode } from \"react\";\nimport { HashRouter, Route, Routes } from \"react-router-dom\";\nimport type { AppConfig } from \"./core/makeAppConfig\";\nimport InfrastructureProvider from \"./InfrastructureProvider\";\nimport useAuthRedirect from \"./useAuthRedirect\";\n\nconst RedirectAuthCode = () => {\n\tuseAuthRedirect();\n\treturn null;\n};\n\ntype AppRoute = {\n\tname: string;\n\tlabel: string;\n\tpath: string;\n\thideFromMenu: boolean;\n\tcomponent: () => ReactNode;\n\tauthorizedGroups?: string[];\n};\n\ntype BaseAppScopeProps = PropsWithChildren<{\n\tappConfig: AppConfig;\n\troutes: AppRoute[];\n}>;\n\nconst BaseAppScope = ({ appConfig, routes, children }: BaseAppScopeProps) => (\n\t<InfrastructureProvider appConfig={appConfig}>\n\t\t<RedirectAuthCode />\n\t\t<HashRouter>\n\t\t\t{children}\n\t\t\t<Routes>\n\t\t\t\t{routes.map((route) => (\n\t\t\t\t\t<Route\n\t\t\t\t\t\tkey={`${route.name}-route`}\n\t\t\t\t\t\tpath={route.path}\n\t\t\t\t\t\telement={<route.component />}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</Routes>\n\t\t</HashRouter>\n\t</InfrastructureProvider>\n);\n\nexport default BaseAppScope;\n\nexport type { AppRoute };\n","type AppMessages = {\n\tLOGIN_SUCCESSFUL: string;\n\tLOGIN_FAILED: string;\n\tLOGOUT_SUCCESSFUL: string;\n\tLOGOUT_FAILED: string;\n\tLOGGED_OUT_USER: string;\n\tLOG_COULD_NOT_LOGIN_WITH_REFRESHED_TOKENS: string;\n\tLOG_COULD_NOT_DECODE_AUTHENTICATION_RESPONSE: string;\n\tLOG_COULD_NOT_GET_REFRESHED_TOKENS: string;\n\tLOG_COULD_NOT_REFRESH_TOKENS: string;\n\tLOG_NO_REFRESH_TOKEN_AVAILABLE: string;\n\tLOG_COULD_NOT_GET_IDENTIFICATION_TOKENS: string;\n};\n\ntype AppConfig = {\n\tappBasePath: string;\n\tappAuthUrl: string;\n\tappClientId: string;\n\tappAuthRedirect: string;\n\tappExternalLoginUrl: string;\n\tappIdentityPoolId: string;\n\tappRegion: string;\n\tappUserPoolId: string;\n\tappLogoUrl: string;\n\tappMessages: AppMessages;\n\thideLogin: boolean;\n\tappRefreshTokenStorageKey: string;\n};\n\ntype MakeAppConfigParam = {\n\tappHost: string;\n\tappBasePath: string;\n\tappRegion: string;\n\tappUserPoolId: string;\n\tappUserPoolDomain: string;\n\tappClientId: string;\n\tappIdentityPoolId: string;\n\tappRefreshTokenStorageKey: string;\n\tappLogoUrl: string;\n\tappMessages: AppMessages;\n\thideLogin?: boolean;\n};\n\nconst makeAppConfig = ({\n\tappHost,\n\tappBasePath,\n\tappRegion,\n\tappUserPoolId,\n\tappUserPoolDomain,\n\tappClientId,\n\tappIdentityPoolId,\n\tappRefreshTokenStorageKey,\n\tappLogoUrl,\n\tappMessages,\n\thideLogin,\n}: MakeAppConfigParam): AppConfig => {\n\tconst appBaseAuthUrl = `https://${appUserPoolDomain}.auth.${appRegion}.amazoncognito.com`;\n\tconst appAuthRedirect = `${appHost}${appBasePath}?auth-redirect`;\n\tconst appAuthUrl = `${appBaseAuthUrl}/oauth2/token`;\n\tconst appExternalLoginUrl = `${appBaseAuthUrl}/login?client_id=${appClientId}&response_type=code&scope=email+openid+profile&redirect_uri=${appAuthRedirect}`;\n\n\treturn {\n\t\tappBasePath,\n\t\tappRegion,\n\t\tappUserPoolId,\n\t\tappClientId,\n\t\tappIdentityPoolId,\n\t\tappAuthRedirect,\n\t\tappAuthUrl,\n\t\tappExternalLoginUrl,\n\t\tappRefreshTokenStorageKey,\n\t\tappLogoUrl,\n\t\tappMessages,\n\t\thideLogin: hideLogin || false,\n\t};\n};\n\nexport default makeAppConfig;\n\nexport type { AppMessages, AppConfig };\n","import { useLocation } from \"react-router-dom\";\nimport useAppConfig from \"./AppConfigContext\";\nimport type { AppRoute } from \"./BaseAppScope\";\nimport useMessage from \"./MessageContext\";\nimport useUser from \"./UserContext\";\n\nconst useAppBarState = (routes: AppRoute[]) => {\n\tconst {\n\t\tappConfig: { appMessages, hideLogin, appExternalLoginUrl },\n\t} = useAppConfig();\n\tconst { showMessage } = useMessage();\n\tconst {\n\t\tuser: { name: userName },\n\t\tlogoff,\n\t} = useUser();\n\n\tconst location = useLocation();\n\n\tconst logoffAndShowMessage = () => {\n\t\tlogoff()\n\t\t\t.then(() => showMessage(appMessages.LOGOUT_SUCCESSFUL))\n\t\t\t.catch(() => showMessage(appMessages.LOGOUT_FAILED));\n\t};\n\n\tconst currentRoute = routes.find((route) => route.path === location.pathname);\n\tconst currentRouteLabel = currentRoute ? currentRoute.label : \"\";\n\n\tconst hideLoginButton = !!userName || hideLogin;\n\tconst hideAccountButton = !userName || hideLogin;\n\n\treturn {\n\t\tcurrentRouteLabel,\n\t\thideLoginButton,\n\t\tappExternalLoginUrl,\n\t\thideAccountButton,\n\t\tuserName,\n\t\tlogoffAndShowMessage,\n\t};\n};\n\nexport default useAppBarState;\n","import useAppConfig from \"./AppConfigContext\";\nimport type { AppRoute } from \"./BaseAppScope\";\nimport useUser from \"./UserContext\";\n\nconst useAppDrawerState = (routes: AppRoute[]) => {\n\tconst {\n\t\tappConfig: { appLogoUrl },\n\t} = useAppConfig();\n\tconst {\n\t\tuser: { groups: userGroups },\n\t} = useUser();\n\n\tconst userFromAuthorizedGroup = (authorizedGroups: string[] | undefined) => {\n\t\tif (!authorizedGroups) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!userGroups) {\n\t\t\treturn false;\n\t\t}\n\t\treturn authorizedGroups.some((authorizedGroup) =>\n\t\t\tuserGroups.includes(authorizedGroup),\n\t\t);\n\t};\n\n\tconst menuRoutes = routes\n\t\t.filter((route) => !route.hideFromMenu)\n\t\t.filter((route) => userFromAuthorizedGroup(route.authorizedGroups));\n\n\treturn { appLogoUrl, menuRoutes };\n};\n\nexport default useAppDrawerState;\n"],"names":["AppConfigContext","createContext","AppConfigProvider","appConfig","children","jsx","useAppConfig","ctx","useContext","initialUserState","getRefreshTokenFromSessionStorage","appRefreshTokenStorageKey","updateRefreshTokenInSessionStorage","refreshToken","stateUpdateFromClearAwsCredentials","stateUpdateFromFailedLogin","stateUpdateFromNewAwsCredentials","awsCredentials","identityId","idToken","accessToken","appMessages","appRegion","idTokenPayload","user","loginWithAwsCognitoIdentityPoolSemDispatch","appIdentityPoolId","appUserPoolId","newCredentials","fromCognitoIdentityPool","CognitoIdentityClient","resolve","reject","creds","err","refreshIdAndAccessTokensSemDispatch","appAuthUrl","appClientId","response","res","stateUpdate","loginWithAuthorizationCodeSemDispatch","authorizationCode","appAuthRedirect","logoff","setUserState","_reject","_prevState","setAppConfig","refreshIdAndAccessTokens","loginWithAwsCognitoIdentityPool","oldState","prevState","loginWithAuthorizationCode","initialUserContextValue","UserContext","useSetInterval","callback","seconds","useEffect","intervalHandle","REFRESH_TOKEN_INTERVAL","UserProvider","userState","useState","_setAppConfig","useCallback","_logoff","_loginWithAwsCognitoIdentityPool","_refreshIdAndAccessTokens","scheduledRefreshIdAndAccessTokens","loginAnonymously","_loginWithAuthorizationCode","useUser","awsConfig","DDBContext","DDBProvider","documentDB","setDocumentDB","ddbClient","DynamoDBClient","DynamoDBDocumentClient","oldDocumentDB","useDDB","ddbGet","params","GetCommand","output","ddbPut","PutCommand","ddbUpdate","UpdateCommand","LambdaContext","LambdaProvider","lambda","setLambda","LambdaClient","oldLambda","invokeLambda","functionName","payload","encoder","decoder","command","InvokeCommand","data","responsePayload","useLambda","MessageContext","_message","MessageProvider","snackPack","setSnackPack","message","setMessage","prev","showMessage","newMessage","dismissMessage","useMessage","useMessageAreaState","SpinnerContext","SpinnerProvider","spinnerCount","setSpinnerCount","showSpinner","dismissSpinner","showing","useSpinner","useSpinnerAreaState","InfrastructureProvider","authRedirect","appBasePath","search","useAuthRedirect","RedirectAuthCode","BaseAppScope","routes","jsxs","HashRouter","Routes","route","Route","makeAppConfig","appHost","appUserPoolDomain","appLogoUrl","hideLogin","appBaseAuthUrl","appExternalLoginUrl","useAppBarState","userName","location","useLocation","logoffAndShowMessage","currentRoute","useAppDrawerState","userGroups","userFromAuthorizedGroup","authorizedGroups","authorizedGroup","menuRoutes"],"mappings":"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"}